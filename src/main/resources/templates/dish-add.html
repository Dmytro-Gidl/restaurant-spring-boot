<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <title>Add Dish</title>

    <link
            href="vendor/font-awesome-4.7/css/font-awesome.min.css"
            rel="stylesheet"
            media="all"
    />
    <link
            href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet"
    />

    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
            crossorigin="anonymous"
    />

    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="/css/form.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
</head>

<body>
<div th:replace="fragments/topnav :: navbar"></div>

<div class="page-wrapper bg-gra-02 p-t-130 p-b-100 font-poppins" id="addBackground">
    <div class="wrapper wrapper--w680">
        <div class="card card-4">
            <div class="card-body">
                <h2 th:text="#{dish.create.form}" class="title">Dish creation form</h2>
                <form action="#" th:action="@{/admin/dishes}" th:object="${dish}"
                      method="post" enctype="multipart/form-data">

                    <div class="row row-space">
                        <div class="col-2">
                            <div style="color: red; margin: 0; padding: 0"
                                 th:if="${#fields.hasErrors('name')}"
                                 th:errors="*{name}">

                            </div>
                            <div class="input-group">
                                <label th:text="#{dish.name}" class="label">Name</label>
                                <input
                                        th:field="*{name}"
                                        class="input--style-4"
                                        type="text"
                                        required
                                />
                            </div>
                        </div>
                        <div class="col-2">
                            <div style="color: red; margin: 0; padding: 0"
                                 th:if="${#fields.hasErrors('description')}"
                                 th:errors="*{description}">

                            </div>
                            <div class="input-group">
                                <label th:text="#{dish.description}" class="label">Description</label>
                                <input
                                        th:field="*{description}"
                                        class="input--style-4"
                                        type="text"
                                        required
                                />
                            </div>
                        </div>
                    </div>
                    <div class="row row-space">
                        <div class="col-2">
                            <div style="color: red; margin: 0; padding: 0"
                                 th:if="${#fields.hasErrors('price')}"
                                 th:errors="*{price}">
                            </div>
                            <div class="input-group">
                                <label th:text="#{dish.price}" class="label">Price</label>
                                <input
                                        th:field="*{price}"
                                        class="input--style-4"
                                        type="number"
                                        min="0"
                                        required

                                />
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="input-group">
                                <label th:text="#{dish.choose.category}" class="label">Choose category</label>
                                <div>

                                    <select th:field="*{category}" class="form-select" aria-label="Choose category">
                                        <option th:each="category : ${categories}"
                                                th:value="${category}" th:text="${category}"></option>
                                    </select>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row row-space">
                        <div class="col-12">
                            <div class="input-group d-flex flex-column">
                                <label class="label" th:text="#{dish.ingredients}">Ingredients</label>
                                <div id="ingredients"></div>
                                <button type="button" id="add-ingredient" class="btn btn-secondary btn-sm mt-2" th:text="#{dish.add.ingredient}">Add ingredient</button>
                            </div>
                        </div>
                    </div>

                    <div class="row row-space">
                        <div class="input-group d-flex flex-column">
                            <!-- ROW -->

                            <label th:text="#{dish.image}" for="image1" class="form-label">Images</label>
                            <div class="mb-3" th:each="i : ${#numbers.sequence(1,4)}">
                                <input type="file" class="form-control" th:id="'image'+${i}" name="images"
                                       accept="image/png, image/jpeg" aria-describedby="imageDescription" />
                                <div class="form-check form-check-inline ms-2">
                                    <input class="form-check-input" type="radio" th:id="'priAdd'+${i}" name="primaryIndex" th:value="${i-1}" th:checked="${i==1}" />
                                    <label class="form-check-label" th:for="'priAdd'+${i}">Primary</label>
                                </div>
                            </div>
                            <div th:text="#{dish.image.description}" id="imageDescription" class="form-text">
                                Images keep their original quality
                            </div>
                            <!-- ROW -->
                        </div>
                    </div>
                    <div class="p-t-15">
                        <button class="button-submit btn--radius-2 btn--blue" type="submit">
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const piecesText = /*[[#{ingredient.unit.pieces}]]*/ 'pcs';
    const gramsText = /*[[#{ingredient.unit.grams}]]*/ 'g';
    let ingredientIndex = 0;
    document.getElementById('add-ingredient').addEventListener('click', function() {
        const container = document.getElementById('ingredients');
        const row = document.createElement('div');
        row.className = 'd-flex mb-2';
        row.innerHTML = `<input class="form-control me-2" name="ingredients[${ingredientIndex}].name" placeholder="Name" required>`+
                        `<input class="form-control me-2" type="number" min="1" name="ingredients[${ingredientIndex}].quantity" placeholder="Qty" required>`+
                        `<select class="form-select me-2" name="ingredients[${ingredientIndex}].unit">`+
                            `<option value="PIECES">${piecesText}</option>`+
                            `<option value="GRAMS">${gramsText}</option>`+
                        `</select>`+
                        `<button type="button" class="btn btn-danger btn-sm remove-ingredient">X</button>`;
        container.appendChild(row);
        ingredientIndex++;
    });
    document.getElementById('ingredients').addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-ingredient')) {
            e.stopPropagation();
            e.target.parentElement.remove();
        }
    });
    document.getElementById('addBackground').addEventListener('click', function(e) {
        const card = document.querySelector('.card');
        if(card && !card.contains(e.target)) {
            window.location.href = '/admin/dishes';
        }
    });
</script>
</body>
</html>
